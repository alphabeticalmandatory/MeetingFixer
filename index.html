<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Time Zone Meeting Scheduler</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Your CSS remains unchanged — keeping it clean and scoped */
    :root {
      --primary: #1976D2;
      --primary-light: #E3F2FD;
      --primary-dark: #0D47A1;
      --text-primary: #212121;
      --text-secondary: #757575;
      --divider: #E0E0E0;
      --white: #FFFFFF;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      max-width: 500px;
      margin: 0 auto;
      padding: 1rem;
      background-color: #f5f5f5;
      color: var(--text-primary);
    }

    h1 {
      color: var(--primary-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card {
      background: var(--white);
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    input[type="datetime-local"] {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-bottom: 1rem;
      border: 1px solid var(--divider);
      border-radius: 4px;
    }

    input[type="datetime-local"]:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
    }

    .actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    button {
      flex: 1;
      padding: 0.75rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    #proposeBtn {
      background-color: var(--primary);
      color: var(--white);
    }

    #acceptBtn {
      background-color: var(--white);
      color: var(--primary);
      border: 1px solid var(--primary);
    }

    .timezone-display {
      background: var(--primary-light);
      padding: 0.75rem;
      border-radius: 4px;
      margin-bottom: 1rem;
      display: flex;
      gap: 0.5rem;
    }

    .status {
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status.empty { background: #f5f5f5; color: var(--text-secondary); }
    .status.pending { background: #FFF3E0; color: #E65100; }
    .status.accepted { background: #E8F5E9; color: #2E7D32; }
    .status.error { background: #FFEBEE; color: #C62828; }

    .time-display {
      margin: 1rem 0;
      padding: 1rem;
      background: var(--primary-light);
      border-radius: 4px;
      color: var(--primary-dark);
      font-weight: 500;
    }

    .share-container {
      margin-top: 1.5rem;
    }

    .share-box {
      display: flex;
      background: var(--white);
      border: 1px solid var(--divider);
      border-radius: 4px;
      overflow: hidden;
    }

    .share-input {
      flex: 1;
      padding: 0.75rem;
      border: none;
      font-size: 0.875rem;
    }

    .share-button {
      background: var(--primary-light);
      border: none;
      padding: 0 1rem;
      cursor: pointer;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary-dark);
      color: white;
      padding: 12px 24px;
      border-radius: 4px;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 8px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1><span class="material-icons">schedule</span>Meeting Scheduler</h1>
    
    <div class="timezone-display">
      <span class="material-icons">public</span>
      Your Time Zone: <strong id="timezone"></strong>
    </div>

    <label for="datetime">Propose Meeting Time:</label>
    <input type="datetime-local" id="datetime" />

    <div class="actions">
      <button id="proposeBtn"><span class="material-icons">send</span>Propose</button>
      <button id="acceptBtn"><span class="material-icons">check</span>Accept</button>
    </div>

    <div class="time-display" id="localView"></div>
    <div class="status empty" id="status">
      <span class="material-icons">info</span>No meeting proposed yet.
    </div>

    <div class="share-container">
      <p>Share this meeting link:</p>
      <div class="share-box">
        <input type="text" id="shareInput" class="share-input" readonly>
        <button class="share-button" id="copyBtn">
          <span class="material-icons">content_copy</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://unpkg.com/yjs"></script>
  <script src="https://unpkg.com/y-webrtc"></script>
  <script>
    const localTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
    document.getElementById("timezone").textContent = localTZ;

    function getRoomIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      let room = urlParams.get("room");

      if (!room) {
        room = Math.random().toString(36).substring(2, 10);
        urlParams.set("room", room);
        const newURL = `${window.location.pathname}?${urlParams.toString()}`;
        window.history.replaceState({}, '', newURL);
      }

      return room;
    }

    const room = getRoomIdFromURL();
    const ydoc = new Y.Doc();
    const provider = new WebrtcProvider(room, ydoc);
    const ymap = ydoc.getMap('meeting');

    const datetimeInput = document.getElementById("datetime");
    const proposeBtn = document.getElementById("proposeBtn");
    const acceptBtn = document.getElementById("acceptBtn");
    const localView = document.getElementById("localView");
    const status = document.getElementById("status");
    const shareInput = document.getElementById("shareInput");
    const copyBtn = document.getElementById("copyBtn");

    function formatTime(utcStr) {
      try {
        const date = new Date(utcStr);
        return date.toLocaleString(undefined, {
          timeZone: localTZ,
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      } catch {
        return 'Invalid time';
      }
    }

    function updateDisplay() {
      const time = ymap.get('time');
      const accepted = ymap.get('acceptedBy') || [];

      if (time) {
        localView.textContent = formatTime(time);

        if (accepted.includes(localTZ)) {
          status.className = 'status accepted';
          status.innerHTML = `<span class="material-icons">check_circle</span>You have accepted this time.`;
        } else {
          status.className = 'status pending';
          status.innerHTML = `<span class="material-icons">pending</span>Pending your acceptance.`;
        }
      } else {
        localView.textContent = '';
        status.className = 'status empty';
        status.innerHTML = `<span class="material-icons">info</span>No meeting proposed yet.`;
      }
    }

    proposeBtn.onclick = () => {
      const value = datetimeInput.value;
      if (!value) return showToast("Please select a date & time", "error");

      const localDate = new Date(value);
      if (isNaN(localDate.getTime())) return showToast("Invalid date", "error");

      const isoString = localDate.toISOString();
      ymap.set('time', isoString);
      ymap.set('acceptedBy', []);
      showToast("Meeting time proposed", "check_circle");
      datetimeInput.value = '';
    };

    acceptBtn.onclick = () => {
      const time = ymap.get('time');
      if (!time) return showToast("No time proposed yet", "error");

      const accepted = ymap.get('acceptedBy') || [];
      if (!accepted.includes(localTZ)) {
        ymap.set('acceptedBy', [...accepted, localTZ]);
        showToast("You accepted the meeting", "check_circle");
      } else {
        showToast("Already accepted", "info");
      }
    };

    function showToast(message, icon = 'info') {
      const toast = document.createElement("div");
      toast.className = "toast";
      toast.innerHTML = `<span class="material-icons">${icon}</span> ${message}`;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = 0;
        setTimeout(() => toast.remove(), 300);
      }, 2500);
    }

    // Populate share link
    shareInput.value = `${window.location.origin}${window.location.pathname}?room=${room}`;
    shareInput.addEventListener('click', () => shareInput.select());
    copyBtn.addEventListener('click', () => {
      shareInput.select();
      document.execCommand("copy");
      showToast("Link copied!", "content_copy");
    });

    ymap.observe(updateDisplay);
    updateDisplay();
  </script>
</body>
</html>

<!-- Keep your HTML head and styles same as before -->

<script src="https://unpkg.com/yjs"></script>
<script src="https://unpkg.com/y-webrtc"></script>
<script>
  const localTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
  document.getElementById('timezone').textContent = localTZ;

  // Generate or get room ID
  const urlParams = new URLSearchParams(window.location.search);
  let room = urlParams.get('room');
  if (!room) {
    room = Math.random().toString(36).substring(2);
    window.location.search = '?room=' + room;
  }

  // Set share link
  const shareInput = document.getElementById('shareInput');
  const copyBtn = document.getElementById('copyBtn');
  shareInput.value = window.location.href;

  copyBtn.addEventListener('click', () => {
    shareInput.select();
    document.execCommand('copy');
    alert("Link copied to clipboard!");
  });

  shareInput.addEventListener('click', () => {
    shareInput.select();
  });

  const ydoc = new Y.Doc();
  const provider = new WebrtcProvider(room, ydoc);
  const ymap = ydoc.getMap('meeting');

  alert("You joined room: " + room); // ✅ Alert on joining

  const datetimeInput = document.getElementById('datetime');
  const proposeBtn = document.getElementById('proposeBtn');
  const acceptBtn = document.getElementById('acceptBtn');
  const localView = document.getElementById('localView');
  const status = document.getElementById('status');

  function formatTime(utcStr) {
    try {
      const date = new Date(utcStr);
      return date.toLocaleString(undefined, {
        timeZone: localTZ,
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    } catch (e) {
      return 'Invalid time';
    }
  }

  function updateDisplay() {
    const time = ymap.get('time');
    const accepted = ymap.get('acceptedBy') || [];

    if (time) {
      localView.textContent = formatTime(time);

      if (accepted.includes(localTZ)) {
        status.className = 'status accepted';
        status.innerHTML = `<span class="material-icons">check_circle</span><span>You have accepted this meeting time.</span>`;
      } else {
        status.className = 'status pending';
        status.innerHTML = `<span class="material-icons">pending</span><span>Pending your acceptance.</span>`;
      }
    } else {
      localView.textContent = "";
      status.className = 'status empty';
      status.innerHTML = `<span class="material-icons">info</span><span>No meeting time proposed yet.</span>`;
    }
  }

  proposeBtn.onclick = () => {
    const value = datetimeInput.value;
    if (!value) {
      alert("Please select a valid date and time.");
      return;
    }

    const localDate = new Date(value);
    if (isNaN(localDate.getTime())) {
      alert("Invalid date/time selected");
      return;
    }

    const isoString = localDate.toISOString();
    ymap.set('time', isoString);
    ymap.set('acceptedBy', []);
    alert("Meeting time proposed: " + formatTime(isoString)); // ✅ Proposal alert

    datetimeInput.value = '';
  };

  acceptBtn.onclick = () => {
    const time = ymap.get('time');
    if (!time) {
      alert("No meeting proposed yet");
      return;
    }

    const accepted = ymap.get('acceptedBy') || [];
    if (!accepted.includes(localTZ)) {
      ymap.set('acceptedBy', [...accepted, localTZ]);
      alert("You accepted the meeting"); // ✅ Acceptance alert
    } else {
      alert("You've already accepted this meeting");
    }
  };

  ymap.observe(() => updateDisplay());
  updateDisplay();
</script>
